---
title: Nginx概览
author: wag
type: post
draft: false
date: 2021-05-25T14:30:07+00:00

---
<blockquote class="wp-block-quote">
  <p>
    <strong>Nginx</strong>（发音同“engine X”）是异步框架的<a href="https://zh.wikipedia.org/wiki/%E7%B6%B2%E9%A0%81%E4%BC%BA%E6%9C%8D%E5%99%A8">网页服务器</a>，也可以用作<a href="https://zh.wikipedia.org/wiki/%E5%8F%8D%E5%90%91%E4%BB%A3%E7%90%86">反向代理</a>、<a href="https://zh.wikipedia.org/wiki/%E8%B4%9F%E8%BD%BD%E5%9D%87%E8%A1%A1">负载平衡器</a>和<a href="https://zh.wikipedia.org/wiki/HTTP%E7%BC%93%E5%AD%98">HTTP缓存</a>。该软件由<a href="https://zh.wikipedia.org/wiki/%E4%BC%8A%E6%88%88%E7%88%BE%C2%B7%E8%B3%BD%E7%B4%A2%E8%80%B6%E5%A4%AB">伊戈尔·赛索耶夫</a>（Игорь Сысоев）创建并于2004年首次公开发布<sup><a href="https://zh.wikipedia.org/wiki/Nginx#cite_note-Mobily-6">[6]</a></sup>。2011年成立同名公司以提供支持<sup><a href="https://zh.wikipedia.org/wiki/Nginx#cite_note-D-7">[7]</a></sup>。2019年3月11日，Nginx公司被<a href="https://zh.wikipedia.org/w/index.php?title=F5_Networks&action=edit&redlink=1">F5 Networks</a>以6.7亿美元收购<sup><a href="https://zh.wikipedia.org/wiki/Nginx#cite_note-8">[8]</a></sup>。
  </p>
  
  <cite>维基百科</cite>
</blockquote>

## <span id="i">特点</span> {.wp-block-heading}

占用内存小：得益于C语言编写，Nginx占用内存小、并发量高（Nginx在官方测试的结果中，能够支持五万个并行连接，而在实际的运作中，可以支持二万至四万个并行连接。）。

高并发：在Linux系统上Nginx使用了Epoll机制，能够高效的处理大量的连接数。

高可靠：Ngxin使用了Master-Worker机制，真正处理请求的是Worker进程，Master进程可以监控Worker进程，并且能在Woker进程意外退出的时候重启该进程。

## <span id="i-2">作用</span> {.wp-block-heading}

负载均衡<figure class="wp-block-image size-full">

<img decoding="async" loading="lazy" width="862" height="380" src="https://aiguo.info/wp-content/uploads/2021/05/image-8.png" alt="" class="wp-image-76" srcset="http://aiguo.info/wp-content/uploads/2021/05/image-8.png 862w, http://aiguo.info/wp-content/uploads/2021/05/image-8-300x132.png 300w, http://aiguo.info/wp-content/uploads/2021/05/image-8-768x339.png 768w" sizes="(max-width: 862px) 100vw, 862px" /> </figure> 

## <span id="i-3">手动安装</span> {.wp-block-heading}

打开[官网][1]，从上到下依次是开发版本、稳定版本、过期版本<figure class="wp-block-image size-full">

<img decoding="async" loading="lazy" width="1283" height="752" src="https://aiguo.info/wp-content/uploads/2021/05/image-1.png" alt="" class="wp-image-64" srcset="http://aiguo.info/wp-content/uploads/2021/05/image-1.png 1283w, http://aiguo.info/wp-content/uploads/2021/05/image-1-300x176.png 300w, http://aiguo.info/wp-content/uploads/2021/05/image-1-1024x600.png 1024w, http://aiguo.info/wp-content/uploads/2021/05/image-1-768x450.png 768w" sizes="(max-width: 1283px) 100vw, 1283px" /> </figure> 

### <span id="i-4">下载并解压缩</span> {.wp-block-heading}



<pre class="EnlighterJSRAW" data-enlighter-language="generic" data-enlighter-theme="" data-enlighter-highlight="" data-enlighter-linenumbers="" data-enlighter-lineoffset="" data-enlighter-title="" data-enlighter-group="">ubuntu@VM-0-6-ubuntu:~$ wget http://nginx.org/download/nginx-1.20.0.tar.gz
ubuntu@VM-0-6-ubuntu:~$ tar -zxvf nginx-1.20.0.tar.gz</pre><figure class="wp-block-image size-full">

<img decoding="async" loading="lazy" width="579" height="359" src="https://aiguo.info/wp-content/uploads/2021/05/image-4.png" alt="" class="wp-image-67" srcset="http://aiguo.info/wp-content/uploads/2021/05/image-4.png 579w, http://aiguo.info/wp-content/uploads/2021/05/image-4-300x186.png 300w" sizes="(max-width: 579px) 100vw, 579px" /> </figure> 

### <span id="i-5">编译源代码</span> {.wp-block-heading}

Linux 的软件在编译的时候要经过三个步骤，configure/make以及make install

1）通用配置选项<figure class="wp-block-image size-full">

<img decoding="async" loading="lazy" width="612" height="163" src="https://aiguo.info/wp-content/uploads/2021/05/image-3.png" alt="" class="wp-image-66" srcset="http://aiguo.info/wp-content/uploads/2021/05/image-3.png 612w, http://aiguo.info/wp-content/uploads/2021/05/image-3-300x80.png 300w" sizes="(max-width: 612px) 100vw, 612px" /> <figcaption>Nginx-Config参数</figcaption></figure> 

2）第三方模块

可以使用&#8211;without-xxx\_module取消自动编译，也可以使用&#8211;with-xxx\_module添加编译

### <span id="i-6">开始编译</span> {.wp-block-heading}



<pre class="EnlighterJSRAW" data-enlighter-language="generic" data-enlighter-theme="" data-enlighter-highlight="" data-enlighter-linenumbers="" data-enlighter-lineoffset="" data-enlighter-title="" data-enlighter-group="">ubuntu@VM-0-6-ubuntu:~/nginx-1.20.0$ ./configure
....
....
./configure: error: the HTTP rewrite module requires the PCRE library.
You can either disable the module by using --without-http_rewrite_module
option, or install the PCRE library into the system, or build the PCRE library
statically from the source with nginx by using --with-pcre=&lt;path&gt; option.</pre>

可以看到缺少PCRE（C语言编写的一个正则表达式库，在Nginx中用于http rewrite）模块，上述报错信息给出了三种解决方式：

<ul id="block-05c5ea26-a7e4-415d-a5ee-db73ec512687">
  <li>
    禁用rewrite 模块
  </li>
  <li>
    将PCRE 模块安装到默认的系统目录中
  </li>
  <li>
    使用源码编译PCRE ，将编译后的文件放到自定义的目录中，在configure 的时候通过&#8211;with-pcre= 的方式。
  </li>
</ul>

这里直接进行安装，相关依赖安装完成后，直接运行

<pre class="EnlighterJSRAW" data-enlighter-language="generic" data-enlighter-theme="" data-enlighter-highlight="" data-enlighter-linenumbers="" data-enlighter-lineoffset="" data-enlighter-title="" data-enlighter-group="">ubuntu@VM-0-6-ubuntu:~/nginx-1.20.0$ ./configure</pre><figure class="wp-block-image size-full">

<img decoding="async" loading="lazy" width="693" height="374" src="https://aiguo.info/wp-content/uploads/2021/05/image-5.png" alt="" class="wp-image-68" srcset="http://aiguo.info/wp-content/uploads/2021/05/image-5.png 693w, http://aiguo.info/wp-content/uploads/2021/05/image-5-300x162.png 300w" sizes="(max-width: 693px) 100vw, 693px" /> </figure> 

<pre class="EnlighterJSRAW" data-enlighter-language="generic" data-enlighter-theme="" data-enlighter-highlight="" data-enlighter-linenumbers="" data-enlighter-lineoffset="" data-enlighter-title="" data-enlighter-group="">ubuntu@VM-0-6-ubuntu:~/nginx-1.20.0$ make
ubuntu@VM-0-6-ubuntu:~/nginx-1.20.0$ sudo make install</pre><figure class="wp-block-image size-large">

<img decoding="async" loading="lazy" width="588" height="515" src="http://49.234.57.68/wp-content/uploads/2021/05/image-6.png" alt="" class="wp-image-69" srcset="http://aiguo.info/wp-content/uploads/2021/05/image-6.png 588w, http://aiguo.info/wp-content/uploads/2021/05/image-6-300x263.png 300w" sizes="(max-width: 588px) 100vw, 588px" /> </figure> 

## <span id="Nginx">启动Nginx</span> {.wp-block-heading}



<pre class="EnlighterJSRAW" data-enlighter-language="generic" data-enlighter-theme="" data-enlighter-highlight="" data-enlighter-linenumbers="" data-enlighter-lineoffset="" data-enlighter-title="" data-enlighter-group="">ubuntu@VM-0-6-ubuntu:~/nginx-1.20.0$ sudo /usr/local/nginx/sbin/nginx</pre><figure class="wp-block-image size-full">

<img decoding="async" loading="lazy" width="1019" height="80" src="https://aiguo.info/wp-content/uploads/2021/05/image-7.png" alt="" class="wp-image-70" srcset="http://aiguo.info/wp-content/uploads/2021/05/image-7.png 1019w, http://aiguo.info/wp-content/uploads/2021/05/image-7-300x24.png 300w, http://aiguo.info/wp-content/uploads/2021/05/image-7-768x60.png 768w" sizes="(max-width: 1019px) 100vw, 1019px" /> </figure> 

### <span id="Nginx-2">Nginx启动参数</span> {.wp-block-heading}

其中常用的就是 -t ， -c , -p ， -g ， -s 这几个。  
-c : 指定nginx 启动时使用的配置文件，默认为/usr/local/nginx/conf/nginx.conf ；  
-t : 测试配置文件的语法是否正确；  
-p : 指定nginx 服务器使用的文件的路径前缀，默认为/usr/local/nginx ；  
-g : 通过命令行指定一些全局配置选项；  
-s : 向nginx 进程发送信号。

## <span id="Ngxin">停止Ngxin</span> {.wp-block-heading}

<div class="wp-block-group is-layout-flow wp-block-group-is-layout-flow">
  <div class="wp-block-group__inner-container">
    <p>
      -s stop: 快速关闭: nginx 强制停止服务， master 和worker 进程收到信号之后，会立即结束运行。<br />-s quit: 1). 关闭监听端口，停止接收新的连接；<br /> 2). Nginx 处理完当前的所有。剩余请求；<br /> 3). 停止Nginx 服务
    </p>
  </div>
</div>

